---
import "../styles/site.css";

const { frontmatter = {} } = Astro.props;

const {
  title = "愛と幽相",
  description = "断片を書き留める場所。",
  showDate = false,
  date: rawDate,
} = frontmatter;

const dateObj = rawDate ? new Date(rawDate) : null;

const displayDate =
  dateObj && !isNaN(dateObj)
    ? dateObj.toISOString().slice(0, 10)
    : null;

const isoDate =
  dateObj && !isNaN(dateObj)
    ? dateObj.toISOString()
    : null;

const siteUrl = "https://itashin1201.github.io";
const pageUrl = new URL(Astro.url.pathname, siteUrl).toString();
---

<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>{title}</title>
    <meta name="description" content={description} />

    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="website" />
    <meta property="og:url" content={pageUrl} />

    <meta name="twitter:card" content="summary" />
    <link rel="icon" href="/favicon.png" />
　  <script>
  (() => {
    const saved = localStorage.getItem("theme");
    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
    const theme = saved ?? (prefersDark ? "dark" : "light");
    document.documentElement.dataset.theme = theme;
  })();
</script>

  </head>

  <body>
  <!-- ★ テーマ切り替えボタン -->
  <button id="theme-toggle" aria-label="Toggle theme">
  dark
</button>

  <main class="container">
    {showDate && (
      <>
        <header class="post-header">
          <div>
            <div class="post-site">愛と幽相</div>
            <h1 class="post-title">{title}</h1>
          </div>

          {displayDate && (
            <time class="post-date" datetime={isoDate}>
              {displayDate}
            </time>
          )}
        </header>

        <div class="back">
          <a href={`${import.meta.env.BASE_URL}blog/`}>← Blog</a>
          <span> / </span>
          <a href={import.meta.env.BASE_URL}>Home</a>
        </div>
      </>
    )}

    <article>
      <slot />
    </article>
  </main>

  <!-- ★ 切り替え用スクリプト -->
 <script>
  const key = "theme";
  const btn = document.getElementById("theme-toggle");

  const apply = (theme) => {
    document.documentElement.dataset.theme = theme;
    btn.textContent = theme === "dark" ? "light" : "dark";
  };

  const saved = localStorage.getItem(key);
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  const initial = saved ?? (prefersDark ? "dark" : "light");
  apply(initial);

  btn.addEventListener("click", () => {
    const next =
      document.documentElement.dataset.theme === "dark"
        ? "light"
        : "dark";
    localStorage.setItem(key, next);
    apply(next);
  });
</script>
</body>
</html>




